# üèóÔ∏è Architecture du Syst√®me C.E.I.

**Documentation compl√®te de l'architecture logicielle du Cadre d'Entra√Ænement Intensif**

---

## üìä Vue d'Ensemble

Le syst√®me C.E.I. est organis√© en **5 couches principales** qui communiquent entre elles :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. Interface Utilisateur (TUI)                         ‚îÇ
‚îÇ     ‚Üì Interactions utilisateur                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  2. C≈ìur du Syst√®me (Agent CEI)                         ‚îÇ
‚îÇ     ‚Üì Orchestration & Logique m√©tier                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  3. Protocoles Adaptatifs (Learning Triggers)           ‚îÇ
‚îÇ     ‚Üì D√©tection & D√©clenchement automatique             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  4. Stockage Local (Fichiers)                           ‚îÇ
‚îÇ     ‚Üì Persistance des donn√©es                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  5. Services Externes (API Gemini)                      ‚îÇ
‚îÇ     ‚Üì G√©n√©ration de contenu IA                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Voir le diagramme complet :** `sys_architectureCEI.mmd`

---

## üñ•Ô∏è Couche 1 : Interface Utilisateur (TUI)

### Responsabilit√©s
- Afficher les menus et interfaces
- Capturer les inputs utilisateur
- Formatter et pr√©senter les donn√©es
- G√©rer la navigation entre phases

### Composants

#### **Menu Principal**
```python
# cei_app/ui/tui.py
class CEITUI:
    def menu_principal(self) -> str:
        # Affiche menu avec Rich
        # Retourne choix: 'nouvelle', 'reprendre', 'arbre', 'historique', 'quitter'
```

**Options :**
- Nouvelle Qu√™te ‚Üí Lance Phase A
- Reprendre Qu√™te ‚Üí Charge session existante
- Consulter Arbre ‚Üí Affiche arbre de comp√©tences
- Historique ‚Üí Liste qu√™tes pass√©es
- Quitter ‚Üí Sauvegarde et quitte

#### **Interface Phase A (Planification)**
```python
def phase_a_planification(self, agent) -> Dict:
    # 1. Capture intention utilisateur
    # 2. Affiche questions de clarification
    # 3. Pr√©sente concepts identifi√©s
    # 4. Affiche qu√™te d√©finie
    # 5. Demande confirmation
```

**Affichage :**
- Panels Rich pour sections
- Prompts interactifs
- Trees pour concepts hi√©rarchiques
- Tables pour crit√®res de succ√®s

#### **Interface Phase B (Ex√©cution)**
```python
def phase_b_execution(self, agent, quete) -> None:
    # 1. Journal en temps r√©el
    # 2. Guidage socratique
    # 3. G√©n√©ration fiche
    # 4. Quiz interactif
    # 5. D√©briefing
```

**Affichage :**
- Live updates pour journal
- Markdown rendering pour fiches
- Progress bars pour √©tapes
- Panels color√©s pour feedback

#### **Affichage Rich**
```python
class Display:
    def afficher_panel(self, titre, contenu, style)
    def afficher_table(self, data)
    def afficher_tree(self, arbre)
    def afficher_markdown(self, md_text)
    def afficher_progress(self, steps)
```

### Technologies
- **Rich** : Composants TUI (Panel, Table, Tree, Progress)
- **Prompt** : Inputs utilisateur interactifs
- **Console** : Affichage format√© et color√©

### Flux de Donn√©es
```
Utilisateur ‚Üí Menu ‚Üí Agent ‚Üí Display ‚Üí Utilisateur
```

---

## üß† Couche 2 : C≈ìur du Syst√®me (Agent CEI)

### Responsabilit√©s
- Orchestrer les phases A et B
- G√©rer le contexte et l'historique
- Communiquer avec Gemini
- G√©n√©rer les artefacts (fiches, quiz)
- Coordonner les protocoles

### Composants

#### **Agent Gemini**
```python
# cei_app/core/agent.py
class CEIAgent:
    def __init__(self, api_key, model_name):
        self.model = genai.GenerativeModel(model_name)
        self.conversation_history = []
        self.context = {
            "journal_entries": [],
            "current_quest": None,
            "competences": []
        }
```

**Attributs :**
- `model` : Instance du mod√®le Gemini
- `conversation_history` : Historique complet
- `context` : Contexte actuel (journal, qu√™te, comp√©tences)

**M√©thodes principales :**
- `generate(prompt, system_context)` : G√©n√©ration avec contexte
- `_build_context_prompt()` : Construction contexte
- `_add_to_history(role, content)` : Ajout historique

#### **Phase A : Planification**

##### **A.1 D√©claration d'Intention**
```python
def declarer_intention(self, intention: str) -> Dict:
    # Prompt socratique pour analyser l'intention
    # Retourne: reformulation, concepts, questions
```

**Entr√©e :** Intention brute de l'utilisateur  
**Sortie :** JSON avec reformulation + questions  
**Prompt :** Socratique, questions ouvertes

##### **A.2 D√©construction des Concepts**
```python
def deconstruire_concepts(self, intention: str, reponses: List[str]) -> List[Dict]:
    # D√©compose en concepts atomiques
    # Retourne: liste de concepts avec pr√©requis
```

**Entr√©e :** Intention + r√©ponses clarification  
**Sortie :** Liste concepts techniques  
**Prompt :** Analyse technique, d√©pendances

##### **A.3 D√©finition de la Qu√™te**
```python
def definir_quete(self, intention: str, concepts: List[Dict]) -> Dict:
    # Transforme en qu√™te SMART
    # Retourne: titre, objectif, crit√®res, dur√©e, livrables
```

**Entr√©e :** Intention + concepts  
**Sortie :** Qu√™te SMART structur√©e  
**Prompt :** P√©dagogique, objectifs mesurables

#### **Phase B : Ex√©cution**

##### **B.1 Exploration & Pratique**
```python
def guider_exploration(self, action_utilisateur: str) -> str:
    # Pose questions socratiques
    # Retourne: question de guidage
```

**Mode :** Continu pendant exploration  
**D√©clencheur :** Chaque action utilisateur  
**Prompt :** Socratique, approfondissement

##### **B.2 Capitalisation (Fiche)**
```python
def generer_fiche(self, journal_entries: List[str]) -> str:
    # G√©n√®re fiche Markdown structur√©e
    # Retourne: fiche compl√®te
```

**Entr√©e :** Journal de session  
**Sortie :** Fiche Markdown  
**Structure :** Objectif, Concepts, Commandes, Pi√®ges, Connexions

##### **B.3 D√©fi Inverse (Quiz)**
```python
def defi_inverse(self, fiche: str) -> Dict:
    # G√©n√®re quiz de validation
    # Retourne: questions + crit√®res
```

**Entr√©e :** Fiche g√©n√©r√©e  
**Sortie :** 3 questions (conceptuelle, pratique, transfert)  
**Format :** JSON avec r√©ponses attendues

##### **B.4 D√©briefing M√©tacognitif**
```python
def debriefing_metacognitif(self, journal_entries: List[str]) -> str:
    # Analyse processus de r√©flexion
    # Retourne: analyse m√©tacognitive
```

**Entr√©e :** Journal complet  
**Sortie :** Analyse Markdown  
**Focus :** Certitudes, doutes, strat√©gies, patterns

##### **B.5 Mise √† Jour Arbre**
```python
def mettre_a_jour_arbre(self, quete: Dict, validation: bool) -> Dict:
    # Met √† jour statut comp√©tences
    # Retourne: arbre mis √† jour
```

**Entr√©e :** Qu√™te + r√©sultat validation  
**Sortie :** Arbre JSON mis √† jour  
**Statuts :** "explor√©" ou "ma√Ætris√©"

### Technologies
- **google-generativeai** : SDK Gemini
- **JSON** : Parsing r√©ponses structur√©es
- **Prompts engineering** : Templates optimis√©s

### Flux de Donn√©es
```
UI ‚Üí Agent ‚Üí Gemini ‚Üí Agent ‚Üí Storage ‚Üí UI
```

---

## ‚ö° Couche 3 : Protocoles Adaptatifs (Learning Triggers)

### Responsabilit√©s
- D√©tecter contextes sp√©cifiques
- D√©clencher protocoles automatiquement
- Enrichir l'apprentissage en temps r√©el

### Composants

#### **D√©tecteur de Contexte**
```python
# cei_app/core/protocols.py
class ContextDetector:
    def __init__(self, config):
        self.error_keywords = ["error", "erreur", "failed", "√©chec"]
        self.similarity_threshold = 0.7
        self.complexity_threshold = 5
    
    def detect_error(self, text: str) -> bool:
        # D√©tecte mots-cl√©s d'erreur
    
    def detect_similarity(self, current, history) -> bool:
        # D√©tecte concepts similaires
    
    def detect_complexity(self, concepts: List) -> bool:
        # D√©tecte complexit√© excessive
```

**M√©thodes de d√©tection :**
- Keywords matching (erreurs)
- Similarit√© s√©mantique (concepts)
- Comptage de complexit√© (nombre concepts)

#### **P.1 Le√ßon de l'Erreur**
```python
class LeconErreur:
    def declencher(self, erreur: str, contexte: str) -> str:
        # 1. Identifier cause racine
        # 2. Expliquer pourquoi
        # 3. Proposer solution
        # 4. G√©n√©raliser le√ßon
```

**D√©clenchement :** D√©tection mot-cl√© erreur  
**Prompt :** Analyse cause racine, g√©n√©ralisation  
**Sortie :** Le√ßon structur√©e Markdown

#### **P.2 Sparring Spontan√©**
```python
class SparringSpontane:
    def declencher(self, concept_actuel: str, historique: List) -> str:
        # 1. Identifier concept similaire pass√©
        # 2. Poser question connexion
        # 3. Approfondir diff√©rences
        # 4. Synth√©tiser
```

**D√©clenchement :** Similarit√© > seuil  
**Prompt :** Questions comparatives  
**Sortie :** Question de connexion

#### **P.3 Synth√®se Dynamique**
```python
class SyntheseDynamique:
    def declencher(self, concepts: List[str]) -> str:
        # 1. Identifier concepts cl√©s
        # 2. Cr√©er carte mentale
        # 3. Clarifier relations
        # 4. Simplifier
```

**D√©clenchement :** Complexit√© > seuil  
**Prompt :** Synth√®se visuelle  
**Sortie :** Carte mentale Markdown

### Configuration
```yaml
# config.yaml
protocols:
  error_detection:
    enabled: true
    keywords: ["error", "erreur", "failed", "√©chec"]
  
  sparring:
    enabled: true
    similarity_threshold: 0.7
  
  synthesis:
    enabled: true
    complexity_threshold: 5
```

### Flux de Donn√©es
```
B.1 Exploration ‚Üí Detector ‚Üí Protocole ‚Üí Agent ‚Üí UI
```

---

## üíæ Couche 4 : Stockage Local

### Responsabilit√©s
- Persister les donn√©es
- Charger les sessions
- Versionner les artefacts
- G√©rer la configuration

### Composants

#### **Journal (Markdown)**
```
cei_app/data/journal/
‚îú‚îÄ‚îÄ 2025-01-14_waybar.md
‚îú‚îÄ‚îÄ 2025-01-15_hyprland.md
‚îî‚îÄ‚îÄ 2025-01-16_neovim.md
```

**Format :**
```markdown
# Journal - [Titre Qu√™te]
**Date :** 2025-01-14 10:30
**Dur√©e :** 2h

## Actions
- 10:30 : Test√© commande X
- 10:45 : Erreur Y rencontr√©e
- 11:00 : Solution trouv√©e

## R√©flexions
- Concept X plus complexe que pr√©vu
- Connexion avec concept Y
```

#### **Fiches (Markdown)**
```
cei_app/data/fiches/
‚îú‚îÄ‚îÄ waybar_configuration.md
‚îú‚îÄ‚îÄ hyprland_keybindings.md
‚îî‚îÄ‚îÄ neovim_plugins.md
```

**Format :** Structure standardis√©e (voir B.2)

#### **Arbre de Comp√©tences (JSON)**
```json
{
  "competences": [
    {
      "nom": "Hyprland",
      "sous_competences": [
        {
          "nom": "Configuration",
          "statut": "ma√Ætris√©",
          "date_acquisition": "2025-01-14",
          "quetes_liees": ["hyprland_setup"]
        },
        {
          "nom": "Keybindings",
          "statut": "explor√©",
          "date_acquisition": "2025-01-15",
          "quetes_liees": ["hyprland_keys"]
        }
      ]
    }
  ]
}
```

#### **Historique Qu√™tes (JSON)**
```json
[
  {
    "id": "quest_001",
    "titre": "Configurer Waybar",
    "date_debut": "2025-01-14T10:00:00",
    "date_fin": "2025-01-14T12:30:00",
    "statut": "compl√©t√©e",
    "validation_reussie": true,
    "concepts_acquis": ["waybar", "css", "json"],
    "fichiers": {
      "journal": "journal/2025-01-14_waybar.md",
      "fiche": "fiches/waybar_configuration.md"
    }
  }
]
```

#### **Configuration (YAML)**
```yaml
# config.yaml
gemini:
  model: "gemini-2.0-flash-exp"
  temperature: 0.7
  max_tokens: 8000

storage:
  data_dir: "cei_app/data"
  journal_dir: "cei_app/data/journal"
  fiches_dir: "cei_app/data/fiches"
  arbre_file: "cei_app/data/arbre.json"
  quetes_file: "cei_app/data/quetes.json"
```

#### **Storage Manager**
```python
# cei_app/storage/manager.py
class StorageManager:
    def sauvegarder_journal(self, quete_id, entries)
    def charger_journal(self, quete_id)
    def sauvegarder_fiche(self, titre, contenu)
    def charger_fiche(self, titre)
    def mettre_a_jour_arbre(self, competences)
    def charger_arbre(self)
    def ajouter_quete(self, quete)
    def charger_quetes(self)
```

### Technologies
- **Pathlib** : Gestion chemins
- **JSON** : Donn√©es structur√©es
- **Markdown** : Documents texte
- **YAML** : Configuration

### Flux de Donn√©es
```
Agent ‚Üí StorageManager ‚Üí Fichiers
Fichiers ‚Üí StorageManager ‚Üí Agent/UI
```

---

## üåê Couche 5 : Services Externes

### Responsabilit√©s
- G√©n√©rer contenu IA
- G√©rer authentification
- Respecter rate limits

### Composants

#### **API Gemini**
```python
import google.generativeai as genai

genai.configure(api_key=os.getenv('GEMINI_API_KEY'))
model = genai.GenerativeModel('gemini-2.0-flash-exp')

response = model.generate_content(prompt)
text = response.text
```

**Mod√®le :** `gemini-2.0-flash-exp`  
**Param√®tres :**
- `temperature` : 0.7 (cr√©ativit√© mod√©r√©e)
- `max_tokens` : 8000 (r√©ponses longues)

**Rate Limits :**
- 60 requ√™tes/minute (gratuit)
- 1500 requ√™tes/jour (gratuit)

#### **Variables d'Environnement**
```bash
# .env
GEMINI_API_KEY=votre_cle_api_ici
```

**Chargement :**
```python
from dotenv import load_dotenv
import os

load_dotenv()
api_key = os.getenv('GEMINI_API_KEY')
```

### Gestion d'Erreurs
```python
try:
    response = model.generate_content(prompt)
except Exception as e:
    if "quota" in str(e).lower():
        # Rate limit atteint
        time.sleep(60)
        retry()
    elif "invalid" in str(e).lower():
        # API key invalide
        raise ConfigError("V√©rifiez GEMINI_API_KEY")
    else:
        # Autre erreur
        log_error(e)
```

### Technologies
- **google-generativeai** : SDK officiel
- **python-dotenv** : Variables env
- **requests** : HTTP (sous le capot)

### Flux de Donn√©es
```
Agent ‚Üí SDK Gemini ‚Üí API Gemini ‚Üí SDK ‚Üí Agent
```

---

## üîÑ Flux de Donn√©es Complets

### Cycle Complet d'une Qu√™te

```
1. D√âMARRAGE
   UI (Menu) ‚Üí Agent (init)

2. PHASE A (Planification)
   UI (intention) ‚Üí Agent (A.1) ‚Üí Gemini ‚Üí Agent ‚Üí UI (questions)
   UI (r√©ponses) ‚Üí Agent (A.2) ‚Üí Gemini ‚Üí Agent ‚Üí UI (concepts)
   Agent (A.3) ‚Üí Gemini ‚Üí Agent ‚Üí UI (qu√™te) ‚Üí Storage (save)

3. PHASE B (Ex√©cution)
   UI (actions) ‚Üí Agent (B.1) ‚Üí Detector ‚Üí Protocoles ‚Üí Gemini ‚Üí Agent ‚Üí UI
   Agent (journal) ‚Üí Storage (save)
   
   Agent (B.2) ‚Üí Gemini ‚Üí Agent ‚Üí UI (fiche) ‚Üí Storage (save)
   Agent (B.3) ‚Üí Gemini ‚Üí Agent ‚Üí UI (quiz)
   UI (r√©ponses) ‚Üí Agent (validation)
   
   Agent (B.4) ‚Üí Gemini ‚Üí Agent ‚Üí UI (d√©briefing)
   Agent (B.5) ‚Üí Storage (arbre) ‚Üí UI (confirmation)

4. FIN
   Agent ‚Üí Storage (save all) ‚Üí UI (r√©sum√©)
```

### Communication entre Couches

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   UI    ‚îÇ ‚Üê‚Üí Display (Rich)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ Commandes/Inputs
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Agent  ‚îÇ ‚Üê‚Üí Context, History
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ Prompts
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Gemini  ‚îÇ ‚Üê‚Üí API Key
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ R√©ponses
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Storage ‚îÇ ‚Üê‚Üí Fichiers
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Patterns Architecturaux

### 1. **MVC Adapt√©**
- **Model** : Storage (donn√©es)
- **View** : UI/Display (affichage)
- **Controller** : Agent (logique)

### 2. **Observer Pattern**
- Detector observe B.1 (Exploration)
- D√©clenche protocoles automatiquement

### 3. **Strategy Pattern**
- Protocoles = strat√©gies interchangeables
- Configuration active/d√©sactive

### 4. **Facade Pattern**
- Agent = facade pour Gemini
- StorageManager = facade pour fichiers

### 5. **Template Method**
- Phase A/B = templates de workflow
- √âtapes d√©finies, impl√©mentation flexible

---

## üîí S√©curit√© & Bonnes Pratiques

### Gestion des Secrets
```python
# ‚úÖ BON
api_key = os.getenv('GEMINI_API_KEY')

# ‚ùå MAUVAIS
api_key = "AIzaSy..."  # Hardcod√©
```

### Gestion d'Erreurs
```python
# ‚úÖ BON
try:
    response = agent.generate(prompt)
except APIError as e:
    logger.error(f"API error: {e}")
    fallback_response()

# ‚ùå MAUVAIS
response = agent.generate(prompt)  # Pas de try/except
```

### Validation des Donn√©es
```python
# ‚úÖ BON
if not intention or len(intention) < 10:
    raise ValueError("Intention trop courte")

# ‚ùå MAUVAIS
# Pas de validation
```

### Logging
```python
# ‚úÖ BON
import logging
logging.info(f"Qu√™te d√©marr√©e: {quete_id}")

# ‚ùå MAUVAIS
print(f"Qu√™te d√©marr√©e: {quete_id}")  # Pas de log structur√©
```

---

## üìà √âvolutivit√©

### Extensions Possibles

#### **1. Support Multi-LLM**
```python
class LLMFactory:
    @staticmethod
    def create(provider: str):
        if provider == "gemini":
            return GeminiAgent()
        elif provider == "openai":
            return OpenAIAgent()
        elif provider == "claude":
            return ClaudeAgent()
```

#### **2. Base de Donn√©es**
```python
# Remplacer JSON par SQLite/PostgreSQL
class DatabaseStorage:
    def __init__(self, db_path):
        self.conn = sqlite3.connect(db_path)
```

#### **3. Interface Web**
```python
# Ajouter FastAPI + React
@app.post("/api/quete/nouvelle")
async def nouvelle_quete(intention: str):
    result = agent.declarer_intention(intention)
    return result
```

#### **4. Collaboration**
```python
# Partage de fiches entre utilisateurs
class FicheRepository:
    def publier(self, fiche, public=False)
    def rechercher(self, query)
    def importer(self, fiche_id)
```

---

## üß™ Tests

### Tests Unitaires
```python
# tests/test_agent.py
def test_declarer_intention():
    agent = CEIAgent()
    result = agent.declarer_intention("Configurer Waybar")
    assert "reformulation" in result
    assert len(result["questions"]) == 3
```

### Tests d'Int√©gration
```python
def test_cycle_complet():
    agent = CEIAgent()
    storage = StorageManager()
    
    # Phase A
    quete = agent.definir_quete(...)
    
    # Phase B
    fiche = agent.generer_fiche(...)
    storage.sauvegarder_fiche(fiche)
    
    assert os.path.exists(fiche_path)
```

### Tests E2E
```python
def test_workflow_complet():
    # Simuler utilisateur complet
    ui = CEITUI()
    agent = CEIAgent()
    
    # Nouvelle qu√™te
    choix = "nouvelle"
    intention = "Test"
    # ... workflow complet
    
    assert quete_completed
```

---

## üìö Ressources

### Documentation Technique
- **Gemini API** : https://ai.google.dev/docs
- **Rich** : https://rich.readthedocs.io/
- **Python Pathlib** : https://docs.python.org/3/library/pathlib.html

### Patterns
- **Design Patterns** : https://refactoring.guru/design-patterns
- **Clean Architecture** : Robert C. Martin

### Diagrammes
- **Mermaid** : https://mermaid.js.org/
- **Visualisation** : `sys_architectureCEI.mmd`

---

## ‚úÖ Checklist Architecture

Avant d'impl√©menter, v√©rifiez :

- [ ] Comprendre les 5 couches
- [ ] Identifier les responsabilit√©s de chaque composant
- [ ] Conna√Ætre les flux de donn√©es
- [ ] Comprendre les patterns utilis√©s
- [ ] Savoir o√π ajouter des fonctionnalit√©s
- [ ] Conna√Ætre les points d'extension

---

**Version** : 1.0  
**Derni√®re mise √† jour** : 2025-01-14  
**Auteur** : Sidix (avec assistance Cascade)
